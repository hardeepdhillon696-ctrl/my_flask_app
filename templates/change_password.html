<<<<<<< HEAD
import re  # Add at the top of your app.py if not already

@app.route("/change_password", methods=["GET", "POST"])
@login_required
def change_password():
    user = User.query.filter_by(username=session["username"]).first()

    if request.method == "POST":
        current_password = request.form["current_password"]
        new_password = request.form["new_password"]

        # Check current password
        if not bcrypt.check_password_hash(user.password, current_password):
            flash("❌ Wrong current password!", "danger")
            return redirect(url_for("change_password"))

        # Backend password validation
        if len(new_password) < 8 or len(new_password) > 20:
            flash("❌ Password must be 8-20 characters long!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[A-Z]", new_password):
            flash("❌ Password must include at least one uppercase letter!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[a-z]", new_password):
            flash("❌ Password must include at least one lowercase letter!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[0-9]", new_password):
            flash("❌ Password must include at least one number!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[!@#$%^&*(),.?\":{}|<>]", new_password):
            flash("❌ Password must include at least one special character!", "danger")
            return redirect(url_for("change_password"))

        # If all checks pass, update password
        user.password = bcrypt.generate_password_hash(new_password).decode("utf-8")
        db.session.commit()
        flash("✅ Password updated successfully!", "success")
        return redirect(url_for("profile", username=user.username))

    return render_template("change_password.html", user=user)
=======
import re  # Add at the top of your app.py if not already

@app.route("/change_password", methods=["GET", "POST"])
@login_required
def change_password():
    user = User.query.filter_by(username=session["username"]).first()

    if request.method == "POST":
        current_password = request.form["current_password"]
        new_password = request.form["new_password"]

        # Check current password
        if not bcrypt.check_password_hash(user.password, current_password):
            flash("❌ Wrong current password!", "danger")
            return redirect(url_for("change_password"))

        # Backend password validation
        if len(new_password) < 8 or len(new_password) > 20:
            flash("❌ Password must be 8-20 characters long!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[A-Z]", new_password):
            flash("❌ Password must include at least one uppercase letter!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[a-z]", new_password):
            flash("❌ Password must include at least one lowercase letter!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[0-9]", new_password):
            flash("❌ Password must include at least one number!", "danger")
            return redirect(url_for("change_password"))
        if not re.search(r"[!@#$%^&*(),.?\":{}|<>]", new_password):
            flash("❌ Password must include at least one special character!", "danger")
            return redirect(url_for("change_password"))

        # If all checks pass, update password
        user.password = bcrypt.generate_password_hash(new_password).decode("utf-8")
        db.session.commit()
        flash("✅ Password updated successfully!", "success")
        return redirect(url_for("profile", username=user.username))

    return render_template("change_password.html", user=user)
>>>>>>> 1c86a86 (Initial commit)
